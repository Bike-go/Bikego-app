{% extends '__main.jinja' %}
{% block content %}
<div class="profile">
    <div class="left_container">
        <div class="user_icon">
            <img src="{{ user.profile_picture_url if user.profile_picture_url else url_for('static', filename='images/user.png') }}"
                alt="Profilový obrázek uživatele {{ user.username }}" referrerpolicy="no-referrer">
        </div>

        <!-- General User Information -->
        <div class="user_row">
            <section class="user_details">
                <form action="" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                    <div class="form-group">
                        <label for="username"><i class="fa-solid fa-user"></i> Uživatelské jméno:</label>
                        <input type="text" name="username" id="username" value="{{ user.username }}" required>
                    </div>

                    <div class="form-group">
                        <label for="email"><i class="fa-solid fa-envelope"></i> Email:</label>
                        <input type="email" name="email" id="email" value="{{ user.email }}" required>
                    </div>

                    <div class="form-group">
                        <label for="phone_number"><i class="fa-solid fa-phone"></i> Telefonní číslo:</label>
                        <input type="text" name="phone_number" id="phone_number"
                            value="{{ user.phone_number if user.phone_number else '' }}">
                    </div>

                    <div class="form-group">
                        <label for="darkmode"><i class="fa-solid fa-moon"></i> Tmavý režim:</label>
                        <select name="darkmode" id="darkmode" aria-label="Dark Mode">
                            <option value="True" {% if user.darkmode %}selected{% endif %}>Zapnuto</option>
                            <option value="False" {% if not user.darkmode %}selected{% endif %}>Vypnuto</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="profile_image"><i class="fa-solid fa-image"></i> Profilový obrázek:</label>
                        <input type="file" name="profile_image" id="profile_image">
                    </div>

                    <button type="submit" class="submit_btn">Uložit změny</button>
                    {% with messages = get_flashed_messages() %}
                    {% if messages %}
                    <ul class=flashes>
                        {% for message in messages %}
                        <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% endwith %}
                </form>
            </section>
        </div>

        <!-- Role-Specific Sections -->
        {% if user.role == 'Admin' %}
        <!-- Admin specific panel options -->
        <div class="admin_panel">
            <p><strong>Admin Panel</strong></p>
            <ul>
                <li><a href="{{ url_for('home') }}">Dashboard</a></li>
                <li><a href="{{ url_for('home') }}">Manage Users</a></li>
                <li><a href="{{ url_for('home') }}">Manage Content</a></li>
            </ul>
        </div>
        {% endif %}

        <div class="user_row">
            <div class="scnd_btn">
                <p><a href="{{ url_for('user_bp.login') }}"><strong>Panel pro správu</strong></a></p>
                <p>
                <form action="{{ url_for('user_bp.logout') }}" method="POST" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit" class="btn-link">Odhlášení</button>
                </form>
                </p>
            </div>
        </div>
    </div>

    <div class="right_container">
        <section class="stats">
            <h2>Moje statistiky</h2>
            <div class="stats_row">
                <span>Celkový čas rezervace:</span>
                <span>{{ total_time }} hours</span>
            </div>
            <div class="stats_row">
                <span>Oblíbený bike:</span>
                <span>{{ favourite_bike[0] if favourite_bike else 'N/A' }} </span>
            </div>
            <div class="stats_row">
                <span>Lorem ipsum:</span>
                <span>{{ lorem_text }} lorem</span>
            </div>
        </section>

        <section class="sessions">
            <h2>Aktivní sezení</h2>
            {% for session, bike in active_sessions %}
            <div class="session_row">
                <img src="{{ url_for('static', filename='images/example.jpg') }}" alt="Aktuální sezení - Bike">
                <div class="session_details">
                    <span>{{ bike.model }}</span>
                    <span>{{ session.reservation_start.strftime('%H:%M:%S') }}</span>
                    <span>{{ session.reservation_start.strftime('%Y-%m-%d') }}</span>
                </div>
            </div>
            {% endfor %}
        </section>

        <section class="reviews">
            <h2>Moje recenze</h2>
            {% for review in reviews %}
            <div class="review_row">
                <span class="review_title">{{ review.comment[:50] }}</span>
                <span class="stars">⭐⭐⭐⭐⭐</span>
                <p>{{ review.comment }}</p>
            </div>
            {% endfor %}
        </section>

        <section class="history">
            <h2>Historie nákupů</h2>
            {% for rental, bike in purchase_history %}
            <div class="history_row">
                <img src="{{ url_for('static', filename='images/example.jpg') }}" alt="Historie nákupu - Bike">
                <div class="history_details">
                    <span>{{ bike.model }}</span>
                    <span>{{ rental.start_time.strftime('%H:%M:%S') }}</span>
                    <span>{{ rental.start_time.strftime('%Y-%m-%d') }}</span>
                </div>
            </div>
            {% endfor %}
            <a href="#" class="show_all">Zobrazit více</a>
        </section>
    </div>

</div>
{% endblock %}